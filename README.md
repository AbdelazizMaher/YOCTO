# YOCTO

**YOCTO project** provides open source, high quality infrastructure and tools to help developers create their own custom Linux distributions for any hardware architecture.

**Yocto?** 

- Yocto is the smallest SI metric system prefix Like 'm' stands for milli ( 10^-3 ).So is yocto ( y = 10^-24 )

		
## What is Yocto Project

To understand the outcome provided by the Yocto Project, we can use the analogy of the computing machine

**Input:** Set of data that describes what we want, that is our specification 

		 (Kernel Configuration, Hardware Name, Packages/Binaries to be installed)

**Output:** Linux Based Embedded Product 

		 (Linux Kernel, Root File System, Bootloader, Device Tree, Toolchain)
		
		
## Setting up Build Machine

### Prerequisites

1. 100 Gbytes of free disk space

2. Runs a supported Linux distribution (i.e. recent releases of Fedora, openSUSE, CentOS, Debian, or Ubuntu). 

3. 
	Git 1.8.3.1 or greater

	tar 1.28 or greater

	Python 3.8.0 or greater

	GNU make 4.0 or greater

#### Packages and package installation vary depending on your development system.

- [x] Install the required packages for Yocto to Work from
        https://www.yoctoproject.org/docs/latest/ref-manual/ref-manual.html#ubuntu-packages

```bash
sudo apt-get install gawk wget git-core diffstat unzip texinfo gcc-multilib \
build-essential chrpath socat cpio python python3 python3-pip python3-pexpect \
xz-utils debianutils iputils-ping python3-git python3-jinja2 libegl1-mesa libsdl1.2-dev \
pylint3 xterm
```
    
## Workflow of Yocto Project

Step 1: Download the Poky Source code

```bash
git clone git://git.yoctoproject.org/poky
```

Step 2: Checkout the latest Long Time Support release (dunfell)

```bash
git checkout dunfell 
```

Step 3: Prepare the build environment

Poky provides you a script **'oe-init-build-env'**, which should be used to setup the build environment, This script will set up your environment to use Yocto build system,including adding the BitBake utility to your path

```bash
# Here build_directory is an optional argument for the name of the directory where the environment is set
#in case it is not given , it defaults to "build"
source poky/oe-init-build-env [ build_directory ]
```

The above script will move you in a build folder and create two files `**( local.conf, bblayers.conf )**` inside conf folder

Step 4: Building Linux Distribution

```bash
#core-image-minimal --->> This is a small image allowing a device to boot, and it is very useful for kernel and boot loader tests and development
bitbake <image_name>
```

### To add a particular package in your root file system

Open your local.conf file and add the recipe name below
```bash
IMAGE_INSTALL:append = " recipe-name"
```

**Note** avoid using +=, =+, .= and =. in `$BUILDDIR/conf/local.conf`. Always use **overrides**


BB_NUMBER_THREADS

	Determines the number of tasks that Bitbake will perform in parallel
	Note: These tasks are related to bitbake and nothing related to compiling
	Defaults to the number of CPUs on the system 
 
	bitbake -e core-image-minimal | grep ^BB_NUMBER_THREADS=
	

PARALLEL_MAKE

	Corresponds to the -j make option
	specifies the number of processes that GNU make can run in parallel on a compilation task
	Defaults to the number of CPUs on the system
 
	bitbake -e core-image-minimal | grep ^PARALLEL_MAKE=

	
### Images generated by Poky Build

The build process writes images out to the Build Directory inside the tmp/deploy/images/machine/ folder

1. kernel-image:
   
		A kernel binary file
		The KERNEL_IMAGETYPE variable determines the naming scheme for the kernel image file.

		bitbake -e core-image-minimal | grep ^KERNEL_IMAGETYPE=
		

3. root-filesystem-image:
   
		Root filesystems for the target device (e.g. *.ext3 or *.bz2 files).
		The `**IMAGE_FSTYPES**` variable determines the root filesystem image type
		Image formats instructions are delivered in Poky: meta/classes/image_types.bbclass
		
		bitbake -e core-image-minimal | grep ^IMAGE_FSTYPES=
   
		
5. kernel-modules:
   
		Tarballs that contain all the modules built for the kernel

7. bootloaders:
   
		If applicable to the target machine, bootloaders supporting the image.

- [x] symlinks
 
	- symbolic link pointing to the most recently built file for each machine
 
	- These links might be useful for external scripts that need to obtain  latest version of each file	

		
### Saving Disk Space while building Yocto 

Yocto Build System can take a lot of disk space during build. But bitbake provides options to preserve disk space

You can tell bitbake to delete all the source code, build files after building a particular recipe by adding the following line in local.conf file
```bash
INHERIT += "rm_work"
```
**Disadvantage:** Difficult to debug while build fails of any recipe.


			
	
